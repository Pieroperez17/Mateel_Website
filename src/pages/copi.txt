import { useState, useEffect } from 'react';
import { FixedSizeList as List } from 'react-window';
import { supabase } from '../supabase';
import PropTypes from 'prop-types';


const ShopPage = () => {
    const [productos, setProductos] = useState([]);
    const [filtro, setFiltro] = useState('');

    useEffect(() => {
        async function fetchProductos() {
        try {
            // Obtén los datos de la tabla 'Productos' de Supabase
            const { data, error } = await supabase
            .from('Productos')
            .select('*')
            .order('id', { ascending: false })
            .range(0, 50); 
            
            if (error) {
            throw error;
            }

            setProductos(data);
        } catch (error) {
            console.error('Error al obtener datos de Supabase:', error.message);
        }
        }

        fetchProductos();
    }, []);

    const handleFiltroChange = (e) => {
        setFiltro(e.target.value);
    };


    const Column = ({ index }) => {
        const imagenUrl = productos[index].imagen ? productos[index].imagen : 'https://i.ibb.co/H4wMgPb/IMAGE-DONT-FOUND.webp';
        return(
            <div className='shop-contain'>
                <img src={imagenUrl} />
                <div className='shop-data'>     
                    <p className='shop-cod'>{productos[index].nombre}</p>
                    <p className='shop-marca'>{productos[index].marca}</p>
                    <p className='shop-id'>{productos[index].id}</p>
                </div>
                <p className='shop-stock'>En Stock : {productos[index].stock}</p>
            </div>
        );
    }
    Column.propTypes = {
        index: PropTypes.number.isRequired,
    };

    const filteredProductos = productos.filter(producto =>
        producto.nombre.toLowerCase().startsWith(filtro.toLowerCase())
    );



    //const altura = productos.length * 430;
    const altoVentana = (filteredProductos.length) * 180;

    return (
        <div className='cont-ada'>
            <div className='cont-head'>
                <h1>Productos</h1>
                <div className='buscador-cont'>
                    <input type='text' placeholder='Busca el codigo de la pieza que buscas' value={filtro} onChange={handleFiltroChange}/>
                </div>
            </div>
            
            <div className='cont-dat'>
                <List
                    height={altoVentana} // Altura de la lista
                    itemCount={filteredProductos.length} // Número total de elementos
                    itemSize={180}  // Altura de cada elemento
                    width={502} // Ancho de la lista
                >
                    {({ index}) => (
                        <Column index={index}  />
                    )}
                </List>
            </div>
        </div>
    );  
}

export default ShopPage;